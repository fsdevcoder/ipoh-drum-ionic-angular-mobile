<ion-header>
    <ion-toolbar>
        <ion-title style="padding:0 0 0 10px;">
            <ion-row class="ion-align-items-center">
                <ion-col size="2" style="text-align:left;padding:0;">
                    <ion-icon name="arrow-back" style="font-size:25px;"
                              (click)="closeInventoryDetailsModal(false)"></ion-icon>
                </ion-col>
                <ion-col size="8" style="text-align:left;white-space:normal;word-wrap:break-word;">
                    <b>Modify Inventory Details</b>
                </ion-col>
                <ion-col size="2" style="text-align:right;">
                    <ion-button fill="clear" (click)="updateInventory()" [disabled]="inventoryInfoFormGroup.invalid
                    || selectedInventory?.inventoryfamilies?.length <= 0
                    || isLoadingPromotionInfo
                    || isLoadingWarrantyInfo
                    || isLoadingShippingInfo">
                        <ion-icon name="checkmark" style="font-size:25px;"></ion-icon>
                    </ion-button>
                </ion-col>
            </ion-row>
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ng-container *ngIf="isLoadingInventoryDetails else finishedLoadingInventory">
        <ion-card style="margin:10px;padding:5px;">
            <ion-row>
                <ion-col size="12">
                    <ion-card style="padding:5px;">
                        <ion-row>
                            <ion-col size="12">
                                <ion-list>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                </ion-list>
                            </ion-col>
                        </ion-row>
                        <ion-row>
                            <ion-col size="12">
                                <ion-list>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:40%;"></ion-skeleton-text>
                                        </ion-label>
                                        <ion-label>
                                            <ion-skeleton-text animated="true" style="width:100%;"></ion-skeleton-text>
                                        </ion-label>
                                    </ion-item>
                                </ion-list>
                            </ion-col>
                        </ion-row>
                    </ion-card>
                </ion-col>
            </ion-row>
        </ion-card>
    </ng-container>
    <ng-template #finishedLoadingInventory>
        <ion-row>
        <ion-col size="12">
            <ion-card style="margin:10px;padding:5px;">
                <ion-row class="ion-align-items-center">
                    <ion-col size="12">
                        <ion-list [formGroup]="inventoryInfoFormGroup">
                            <ion-item>
                                <ion-label position="floating">Inventory Name</ion-label>
                                <ion-input [(ngModel)]="selectedInventory.name"
                                           formControlName="inventoryName"></ion-input>
                            </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventoryName').invalid && inventoryInfoFormGroup.get('inventoryName').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryName').hasError('required') && inventoryInfoFormGroup.get('inventoryName').touched">
                                    Name is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryName').hasError('minlength') && inventoryInfoFormGroup.get('inventoryName').touched">
                                    Name must have at
                                    least {{inventoryNameMinLength}}
                                    characters.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryName').hasError('maxlength') && inventoryInfoFormGroup.get('inventoryName').touched">
                                    Name cannot be more
                                    than {{inventoryNameMaxLength}}
                                    characters.
                                </li>
                            </ul>
                            <ion-item>
                                <ion-label position="floating">Code</ion-label>
                                <ion-input [(ngModel)]="selectedInventory.code"
                                           formControlName="inventoryCode"></ion-input>
                            </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventoryCode').invalid && inventoryInfoFormGroup.get('inventoryCode').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCode').hasError('required') && inventoryInfoFormGroup.get('inventoryCode').touched">
                                    Code is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCode').hasError('minlength') && inventoryInfoFormGroup.get('inventoryCode').touched">
                                    Code must have at
                                    least {{inventoryCodeMinLength}}
                                    characters.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCode').hasError('maxlength') && inventoryInfoFormGroup.get('inventryCode').touched">
                                    Code cannot be more
                                    than {{inventoryCodeMaxLength}}
                                    characters.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCode').hasError('pattern') && inventoryInfoFormGroup.get('inventryCode').touched">
                                    Code must contain alphanumeric characters only.
                                </li>
                            </ul>
                            <ion-item>
                                <ion-label position="floating">SKU</ion-label>
                                <ion-input [(ngModel)]="selectedInventory.sku"
                                           formControlName="inventorySKU"></ion-input>
                            </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventorySKU').invalid && inventoryInfoFormGroup.get('inventorySKU').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventorySKU').hasError('required') && inventoryInfoFormGroup.get('inventorySKU').touched">
                                    SKU is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventorySKU').hasError('minlength') && inventoryInfoFormGroup.get('inventorySKU').touched">
                                    SKU must have at
                                    least {{inventoryCodeMinLength}}
                                    characters.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventorySKU').hasError('maxlength') && inventoryInfoFormGroup.get('inventorySKU').touched">
                                    SKU cannot be more
                                    than {{inventoryCodeMaxLength}}
                                    characters.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventorySKU').hasError('pattern') && inventoryInfoFormGroup.get('inventorySKU').touched">
                                    SKU must contain alphanumeric characters only.
                                </li>
                            </ul>
                            <ion-item>
                                <ion-label position="floating">Description</ion-label>
                                <ion-textarea cols="20" rows="3" [(ngModel)]="selectedInventory.desc"
                                              formControlName="inventoryDescription"></ion-textarea>
                            </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventoryDescription').invalid && inventoryInfoFormGroup.get('inventoryDescription').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryDescription').hasError('required') && inventoryInfoFormGroup.get('inventoryDescription').touched">
                                    Description is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryDescription').hasError('minlength') && inventoryInfoFormGroup.get('inventoryDescription').touched">
                                    Description must have at
                                    least {{inventoryDescMinLength}}
                                    characters.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryDescription').hasError('maxlength') && inventoryInfoFormGroup.get('inventoryDescription').touched">
                                    Description cannot be more
                                    than {{inventoryDescMaxLength}}
                                    characters.
                                </li>
                            </ul>
                            <ion-item>
                                <ion-label position="floating">Cost</ion-label>
                                <ion-input [(ngModel)]="selectedInventory.cost"
                                           formControlName="inventoryCost"></ion-input>
                            </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventoryCost').invalid && inventoryInfoFormGroup.get('inventoryCost').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCost').hasError('required') && inventoryInfoFormGroup.get('inventoryCost').touched">
                                    Cost is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCost').hasError('maxlength') && inventoryInfoFormGroup.get('inventoryCost').touched">
                                    Cost cannot be more
                                    than {{inventoryDescMaxLength}} digits.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryCost').hasError('pattern') && inventoryInfoFormGroup.get('inventoryCost').touched">
                                    Cost format should be [123] or [123.00].
                                </li>
                            </ul>
                            <ion-item>
                                <ion-label position="floating">Base Price</ion-label>
                                <ion-input [(ngModel)]="selectedInventory.price"
                                           formControlName="inventoryBasePrice"></ion-input>
                            </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventoryBasePrice').invalid && inventoryInfoFormGroup.get('inventoryBasePrice').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryBasePrice').hasError('required') && inventoryInfoFormGroup.get('inventoryBasePrice').touched">
                                    Base Price is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryBasePrice').hasError('maxlength') && inventoryInfoFormGroup.get('inventoryBasePrice').touched">
                                    Base Price cannot be more
                                    than {{inventoryDescMaxLength}}
                                    digits.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryBasePrice').hasError('pattern') && inventoryInfoFormGroup.get('inventoryBasePrice').touched">
                                    Base Price format should be [123] or
                                    [123.00].
                                </li>
                            </ul>
                            <ion-item>
                                <ion-label position="floating">Stock's Threshold</ion-label>
                                <ion-input [(ngModel)]="selectedInventory.stockthreshold"
                                           formControlName="inventoryStockThreshold"></ion-input>
                           </ion-item>
                            <ul class="error"
                                *ngIf="inventoryInfoFormGroup.get('inventoryStockThreshold').invalid && inventoryInfoFormGroup.get('inventoryStockThreshold').touched">
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryStockThreshold').hasError('required') && inventoryInfoFormGroup.get('inventoryStockThreshold').touched">
                                    Stock's Threshold is required.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryStockThreshold').hasError('maxlength') && inventoryInfoFormGroup.get('inventoryStockThreshold').touched">
                                    Stock's Threshold cannot be more
                                    than {{inventoryStockThresholdMaxLength}}
                                    digits.
                                </li>
                                <li *ngIf="inventoryInfoFormGroup.get('inventoryStockThreshold').hasError('pattern') && inventoryInfoFormGroup.get('inventoryStockThreshold').touched">
                                    Stock's Threshold must contain digits only.
                                </li>
                            </ul>
                        </ion-list>
                    </ion-col>
                </ion-row>
            </ion-card>
            <ng-container *ngIf="isLoadingPromotionInfo else finishedLoadingPromotionInfo">
                <ion-card>
                    <ion-row class="ion-align-items-center">
                        <ion-col size="12" style="text-align:center;height:100%;">
                            <ion-spinner name="crescent"></ion-spinner>
                        </ion-col>
                    </ion-row>
                </ion-card>
            </ng-container>
            <ng-template #finishedLoadingPromotionInfo>
                <ion-card style="margin:10px;padding:5px;">
                    <ion-card-header style="border-bottom:1px solid #f2f2f2;">
                        Promotion Details
                    </ion-card-header>
                    <ion-card-content style="padding:0 5px 5px 5px;">
                        <ion-row class="ion-align-items-center">
                            <ion-col size="4">
                                <b>Promotion Plans</b>
                            </ion-col>
                            <ion-col size="8">
                                <ionic-selectable
                                        [placeholder]="'Select Promotion'"
                                        [(ngModel)]="selectedProductPromotionPlan"
                                        [items]="listOfStorePromotions"
                                        [hasInfiniteScroll]="true"
                                        (onInfiniteScroll)="retrieveMorePromotions($event)"
                                        (onSearch)="searchForPromotions($event)"
                                        [canSearch]="true"
                                        itemValueField="id"
                                        itemTextField="name">
                                </ionic-selectable>
                            </ion-col>
                        </ion-row>
                        <ion-row class="ion-align-items-center" *ngIf="selectedProductPromotionPlan && selectedProductPromotionPlan.desc">
                            <ion-col size="12">
                                <div class="alert alert-primary" role="alert" style="margin-bottom:0;">
                                    {{selectedProductPromotionPlan?.desc}}
                                </div>
                            </ion-col>
                        </ion-row>
                    </ion-card-content>
                </ion-card>
            </ng-template>
            <ng-container *ngIf="isLoadingWarrantyInfo else finishedLoadingWarrantyInfo">
                <ion-card>
                    <ion-row class="ion-align-items-center">
                        <ion-col size="12" style="text-align:center;height:100%;">
                            <ion-spinner name="crescent"></ion-spinner>
                        </ion-col>
                    </ion-row>
                </ion-card>
            </ng-container>
            <ng-template #finishedLoadingWarrantyInfo>
                <ion-card style="margin:10px;padding:5px;" *ngIf="!isLoadingWarrantyInfo">
                    <ion-card-header style="border-bottom:1px solid #f2f2f2;">
                        Warranty Details
                    </ion-card-header>
                    <ion-card-content style="padding:0 5px 5px 5px;">
                        <ion-row class="ion-align-items-center">
                            <ion-col size="4">
                                <b>Warranty Plans</b>
                            </ion-col>
                            <ion-col size="8">
                                <ionic-selectable
                                        [placeholder]="'Select Warranty'"
                                        [(ngModel)]="selectedWarrantyPlan"
                                        [items]="listOfStoreWarranties"
                                        [hasInfiniteScroll]="true"
                                        (onInfiniteScroll)="retrieveMoreWarranties($event)"
                                        (onSearch)="searchForWarranties($event)"
                                        [canSearch]="true"
                                        itemValueField="id"
                                        itemTextField="name">
                                </ionic-selectable>
                            </ion-col>
                        </ion-row>
                        <ion-row class="ion-align-items-center" *ngIf="selectedWarrantyPlan && selectedWarrantyPlan.desc">
                            <ion-col size="12">
                                <div class="alert alert-success" role="alert" style="margin-bottom:0;">
                                    {{selectedWarrantyPlan?.desc}}
                                </div>
                            </ion-col>
                        </ion-row>
                    </ion-card-content>
                </ion-card>
            </ng-template>
            <ng-container *ngIf="isLoadingShippingInfo else finishedLoadingShippingInfo">
                <ion-card>
                    <ion-row class="ion-align-items-center">
                        <ion-col size="12" style="text-align:center;height:100%;">
                            <ion-spinner name="crescent"></ion-spinner>
                        </ion-col>
                    </ion-row>
                </ion-card>
            </ng-container>
            <ng-template #finishedLoadingShippingInfo>
                <ion-card style="margin:10px;padding:5px;" *ngIf="!isLoadingShippingInfo">
                    <ion-card-header style="border-bottom:1px solid #f2f2f2;">
                        Shipping Details
                    </ion-card-header>
                    <ion-card-content style="padding:0 5px 5px 5px;">
                        <ion-row class="ion-align-items-center">
                            <ion-col size="4">
                                <b>Shipping Plans</b>
                            </ion-col>
                            <ion-col size="8">
                                <ionic-selectable
                                        [placeholder]="'Select Promotion'"
                                        [(ngModel)]="selectedShippingPlan"
                                        [items]="listOfStoreShippings"
                                        [hasInfiniteScroll]="true"
                                        (onInfiniteScroll)="retrieveMoreShippings($event)"
                                        (onSearch)="searchForShippings($event)"
                                        [canSearch]="true"
                                        itemValueField="id"
                                        itemTextField="name">
                                </ionic-selectable>
                            </ion-col>
                        </ion-row>
                        <ion-row class="ion-align-items-center" *ngIf="selectedShippingPlan && selectedShippingPlan.desc">
                            <ion-col size="12">
                                <div class="alert alert-info" role="alert" style="margin-bottom:0;">
                                    {{selectedShippingPlan?.desc}}
                                </div>
                            </ion-col>
                        </ion-row>
                    </ion-card-content>
                </ion-card>
            </ng-template>
            <ion-card style="margin:10px;padding:5px;">
                <ion-card-header style="border-bottom:1px solid #f2f2f2;">
                    Inventory Families & Patterns
                </ion-card-header>
                <ion-card-content style="padding:0 5px 5px 5px;">
                    <ion-row class="ion-align-items-center">
                        <ion-col size="12">
                            <ion-button color="warning" (click)="openAddInventoryFamilyAndPatternModal()">
                                Add Families & Patterns&nbsp;<ion-icon
                                    name="add-circle"></ion-icon>
                            </ion-button>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col size="12" style="width:100%;overflow-x:auto;">
                            <table class="table" style="margin-bottom:0;">
                                <thead class="thead-dark">
                                <tr>
                                    <th style="width:50%;">Families</th>
                                    <th style="width:45%;">Patterns</th>
                                    <th style="width:5%;text-align:center;">Action</th>
                                </tr>
                                </thead>
                                <tbody *ngIf="selectedInventory?.inventoryfamilies?.length === 0"
                                       style="background-color:white;border-bottom:1px solid #f2f2f2;border-left:1px solid #f2f2f2;border-right:1px solid #f2f2f2;">
                                <tr>
                                    <td colspan="3" style="color:grey;">No inventory families and patterns.</td>
                                </tr>
                                </tbody>
                                <tbody *ngIf="selectedInventory?.inventoryfamilies?.length > 0"
                                       style="background-color:white;border-bottom:1px solid #f2f2f2;border-left:1px solid #f2f2f2;border-right:1px solid #f2f2f2;">
                                <tr *ngFor="let invFamilyPattern of selectedInventory?.inventoryfamilies;let i = index;">
                                    <td>
                                        <span class="badge badge-primary" style="white-space:normal;word-wrap:break-word;">
                                            {{invFamilyPattern?.name}}
                                        </span>
                                    </td>
                                    <td>
                                        <ng-container
                                                *ngIf="invFamilyPattern?.patterns.length > 0 else noPattern">
                                                <span class="badge badge-info" style="white-space:normal;word-wrap:break-word;"
                                                      *ngFor="let pattern of invFamilyPattern?.patterns;let j = index;">
                                                {{pattern?.name}}
                                            </span>
                                        </ng-container>
                                        <ng-template #noPattern>
                                                <span class="badge badge-dark">
                                                    NONE
                                                </span>
                                        </ng-template>
                                    </td>
                                    <td>
                                        <ion-button fill="clear" style="padding:0;"
                                                    (click)="removeSelectedInventoryFamilyAndOrPattern(i)">
                                            <ion-icon name="trash" style="color:#cbcbcb;"></ion-icon>
                                        </ion-button>
                                        <ion-button fill="clear" style="padding:0;" (click)="openEditInventoryFamiliesAndPatternsModal(invFamilyPattern)">
                                            <ion-icon name="build" style="color:#cbcbcb;"></ion-icon>
                                        </ion-button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </ion-col>
                    </ion-row>
                </ion-card-content>
            </ion-card>
        </ion-col>
    </ion-row>
    </ng-template>
</ion-content>
